{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mikae/Documents/ProjetosdeProgramacao/projeto-financeiro/frontend/app/budget/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst API_URL = 'http://localhost:8000';\r\n\r\n// --- Componente: Banner de Alerta (NOVO) ---\r\nfunction AlertBanner({ overBudgetGroups }) {\r\n  if (overBudgetGroups.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"bg-red-900/30 border-l-4 border-fin-red p-4 mb-8 rounded-r-xl backdrop-blur-md animate-pulse\">\r\n      <div className=\"flex items-start\">\r\n        <div className=\"flex-shrink-0\">\r\n          <svg className=\"h-6 w-6 text-fin-red\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n          </svg>\r\n        </div>\r\n        <div className=\"ml-3\">\r\n          <h3 className=\"text-lg font-bold text-fin-red\">AtenÃ§Ã£o ao OrÃ§amento!</h3>\r\n          <div className=\"mt-1 text-sm text-gray-300\">\r\n            <p>\r\n              VocÃª excedeu o limite planejado nos seguintes grupos:\r\n            </p>\r\n            <ul className=\"list-disc list-inside mt-2 text-white font-semibold\">\r\n              {overBudgetGroups.map(group => (\r\n                <li key={group.group_id}>\r\n                  {group.name} (Estourado em {(group.actual_spent - group.planned_amount).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })})\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// --- Seletor de MÃªs ---\r\nfunction MonthSelector({ currentDate, onDateChange }) {\r\n  const handlePreviousMonth = () => {\r\n    const newDate = new Date(currentDate);\r\n    newDate.setMonth(newDate.getMonth() - 1);\r\n    onDateChange(newDate);\r\n  };\r\n  const handleNextMonth = () => {\r\n    const newDate = new Date(currentDate);\r\n    newDate.setMonth(newDate.getMonth() + 1);\r\n    onDateChange(newDate);\r\n  };\r\n  const formattedDate = currentDate.toLocaleString('pt-BR', { month: 'long', year: 'numeric' }).replace(/^\\w/, (c) => c.toUpperCase());\r\n\r\n  return (\r\n    <div className=\"flex justify-between items-center mb-8 bg-fin-card/30 p-4 rounded-2xl border border-white/5\">\r\n      <button onClick={handlePreviousMonth} className=\"p-2 text-fin-gold hover:bg-fin-card rounded-full transition-colors\">\r\n        &lt; Anterior\r\n      </button>\r\n      <h2 className=\"text-2xl font-light text-white tracking-wide\">{formattedDate}</h2>\r\n      <button onClick={handleNextMonth} className=\"p-2 text-fin-gold hover:bg-fin-card rounded-full transition-colors\">\r\n        PrÃ³ximo &gt;\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function BudgetPage() {\r\n  const [currentDate, setCurrentDate] = useState(new Date());\r\n  const [analysisData, setAnalysisData] = useState(null);\r\n  const [totalPercentage, setTotalPercentage] = useState(0);\r\n  const [overBudgetGroups, setOverBudgetGroups] = useState([]); // ðŸ‘ˆ NOVO ESTADO PARA ALERTAS\r\n\r\n  // FunÃ§Ã£o de busca definida antes do useEffect\r\n  const fetchAnalysis = async () => {\r\n    const month = currentDate.getMonth() + 1;\r\n    const year = currentDate.getFullYear();\r\n    try {\r\n      const response = await axios.get(`${API_URL}/budget/analysis?month=${month}&year=${year}`);\r\n      setAnalysisData(response.data);\r\n      \r\n      const totalPerc = response.data.analysis.reduce((acc, group) => acc + group.target_percentage, 0);\r\n      setTotalPercentage(totalPerc);\r\n\r\n      // Filtra os grupos que estouraram o orÃ§amento\r\n      const alerts = response.data.analysis.filter(group => group.is_over_budget);\r\n      setOverBudgetGroups(alerts);\r\n\r\n    } catch (error) {\r\n      console.error(\"Erro ao buscar anÃ¡lise de orÃ§amento:\", error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchAnalysis();\r\n  }, [currentDate]);\r\n\r\n  const handlePercentageChange = (groupId, newValue) => {\r\n    axios.put(`${API_URL}/budget/${groupId}?target_percentage=${newValue}`)\r\n      .then(() => {\r\n        fetchAnalysis();\r\n      })\r\n      .catch(error => console.error(\"Erro ao atualizar porcentagem:\", error));\r\n  };\r\n\r\n  const formatCurrency = (value) => {\r\n    return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });\r\n  };\r\n\r\n  if (!analysisData) return <div className=\"text-white flex justify-center items-center h-64\">Carregando anÃ¡lise...</div>;\r\n\r\n  return (\r\n    <div>\r\n      <h1 className=\"text-3xl font-bold mb-6 text-white\">Planejado vs. Realizado</h1>\r\n      \r\n      <MonthSelector currentDate={currentDate} onDateChange={setCurrentDate} />\r\n\r\n      {/* ðŸ‘‡ INSERE O BANNER DE ALERTA AQUI ðŸ‘‡ */}\r\n      <AlertBanner overBudgetGroups={overBudgetGroups} />\r\n\r\n      {/* Resumo do MÃªs */}\r\n      <div className=\"bg-fin-card/80 p-6 rounded-2xl shadow-lg mb-8 flex justify-between items-center border border-white/5 backdrop-blur-sm\">\r\n        <div>\r\n          <h2 className=\"text-gray-300 text-sm font-medium mb-1\">Renda em {currentDate.toLocaleString('pt-BR', { month: 'long' })}</h2>\r\n          <p className=\"text-4xl font-bold text-fin-gold\">{formatCurrency(analysisData.total_income)}</p>\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <h2 className=\"text-gray-300 text-sm font-medium mb-1\">Planejamento Total</h2>\r\n          <p className={`text-3xl font-bold ${totalPercentage === 100 ? 'text-fin-highlight' : 'text-fin-terra'}`}>\r\n            {totalPercentage}%\r\n          </p>\r\n          {totalPercentage !== 100 && <span className=\"text-xs text-fin-red block mt-1\">Ajuste para 100%</span>}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista Comparativa */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {analysisData.analysis.map(group => {\r\n          let spendPercentage = 0;\r\n          if (group.planned_amount > 0) {\r\n            spendPercentage = (group.actual_spent / group.planned_amount) * 100;\r\n          } else if (group.actual_spent > 0) {\r\n            spendPercentage = 100; \r\n          }\r\n          const visualPercentage = Math.min(spendPercentage, 100);\r\n\r\n          return (\r\n            <div key={group.group_id} className={`p-6 rounded-2xl shadow-lg border transition-all duration-300 ${group.is_over_budget ? 'bg-fin-dark/90 border-fin-red/50 shadow-fin-red/20' : 'bg-fin-dark/60 border-white/5 hover:bg-fin-dark/80'}`}>\r\n              <div className=\"flex justify-between items-start mb-4\">\r\n                <div>\r\n                  <h3 className=\"text-xl font-bold text-white\">{group.name}</h3>\r\n                  <div className=\"flex items-center gap-2 mt-1\">\r\n                    <span className=\"text-sm text-gray-400\">Meta:</span>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      max=\"100\"\r\n                      value={group.target_percentage}\r\n                      onChange={(e) => handlePercentageChange(group.group_id, e.target.value)}\r\n                      className=\"w-14 bg-fin-dark/50 text-center border border-fin-card rounded-md text-fin-highlight font-bold focus:outline-none focus:border-fin-gold\"\r\n                    />\r\n                    <span className=\"text-fin-highlight\">%</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                  <span className=\"text-gray-400 text-xs block uppercase tracking-wider\">Realizado</span>\r\n                  <span className={`text-2xl font-bold ${group.is_over_budget ? 'text-fin-red' : 'text-white'}`}>\r\n                    {formatCurrency(group.actual_spent)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"mb-2\">\r\n                <div className=\"flex justify-between text-xs mb-1\">\r\n                  <span className=\"text-gray-400\">\r\n                    Planejado: <strong className=\"text-fin-gold\">{formatCurrency(group.planned_amount)}</strong>\r\n                  </span>\r\n                  <span className={`font-semibold ${group.is_over_budget ? 'text-fin-red' : 'text-green-400'}`}>\r\n                    {spendPercentage.toFixed(0)}% gasto\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-black/30 rounded-full h-4 p-0.5 border border-white/5 overflow-hidden relative\">\r\n                  <div \r\n                    className={`h-full rounded-full shadow-lg transition-all duration-700 ease-out ${group.is_over_budget ? 'bg-gradient-to-r from-red-600 to-fin-red' : 'bg-gradient-to-r from-green-600 to-green-400'}`} \r\n                    style={{ width: `${visualPercentage}%` }}\r\n                  ></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}