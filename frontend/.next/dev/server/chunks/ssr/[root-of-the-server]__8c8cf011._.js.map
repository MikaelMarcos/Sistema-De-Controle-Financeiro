{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mikae/Documents/ProjetosdeProgramacao/projeto-financeiro/frontend/app/expenses/page.js"],"sourcesContent":["'use client'; \r\n\r\nimport { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst API_URL = 'http://localhost:8000';\r\n\r\n// --- Componente do Formul치rio de Despesas (ATUALIZADO) ---\r\nfunction ExpenseForm({ onExpenseAdded }) {\r\n  const [description, setDescription] = useState('');\r\n  const [amount, setAmount] = useState('');\r\n  const [date, setDate] = useState('');\r\n  const [categoryId, setCategoryId] = useState('');\r\n  const [categories, setCategories] = useState([]);\r\n  \r\n  // 游녢 NOVOS ESTADOS PARA VINCULAR METAS\r\n  const [goals, setGoals] = useState([]);\r\n  const [selectedGoalId, setSelectedGoalId] = useState('');\r\n  const [metaCategoryId, setMetaCategoryId] = useState(null);\r\n\r\n  // Busca categorias e metas\r\n  useEffect(() => {\r\n    Promise.all([\r\n      axios.get(`${API_URL}/categories/`),\r\n      axios.get(`${API_URL}/goals/`)\r\n    ])\r\n    .then(([categoriesRes, goalsRes]) => {\r\n      const allCategories = categoriesRes.data;\r\n      setCategories(allCategories);\r\n      setGoals(goalsRes.data);\r\n\r\n      // Seta a primeira categoria como padr칚o\r\n      if (allCategories.length > 0) {\r\n        setCategoryId(allCategories[0].id);\r\n      }\r\n      \r\n      // Encontra e armazena o ID da categoria \"Sonhos/metas\"\r\n      const metaCat = allCategories.find(\r\n        cat => cat.name.toLowerCase().includes(\"sonhos\")\r\n      );\r\n      if (metaCat) {\r\n        setMetaCategoryId(metaCat.id);\r\n      }\r\n    })\r\n    .catch(error => console.error(\"Erro ao buscar dados:\", error));\r\n  }, []);\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    if (!description || !amount || !categoryId) {\r\n      alert(\"Por favor, preencha todos os campos.\");\r\n      return;\r\n    }\r\n\r\n    const newExpense = {\r\n      description: description,\r\n      amount: parseFloat(amount),\r\n      category_id: parseInt(categoryId),\r\n      goal_id: null\r\n    };\r\n\r\n    // Adiciona a data\r\n    if (date) {\r\n      newExpense.date = new Date(date).toISOString(); \r\n    }\r\n    \r\n    // 游녢 ADICIONA O ID DA META SE ESTIVER SELECIONADO\r\n    if (parseInt(categoryId) === metaCategoryId && selectedGoalId) {\r\n      newExpense.goal_id = parseInt(selectedGoalId);\r\n    }\r\n\r\n    axios.post(`${API_URL}/expenses/`, newExpense)\r\n      .then(response => {\r\n        setDescription('');\r\n        setAmount('');\r\n        setDate('');\r\n        setSelectedGoalId(''); // Limpa o seletor de meta\r\n        onExpenseAdded(response.data); \r\n      })\r\n      .catch(error => console.error(\"Erro ao adicionar despesa:\", error));\r\n  };\r\n  \r\n  // Verifica se a categoria de \"sonhos\" est치 selecionada\r\n  const isMetaCategorySelected = parseInt(categoryId) === metaCategoryId;\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"bg-gray-800 p-6 rounded-lg shadow-lg mb-8\">\r\n      <h2 className=\"text-2xl font-bold mb-4 text-red-400\">Nova Despesa</h2>\r\n      \r\n      {/* Linha 1: Descri칞칚o e Valor */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\"> \r\n        <input\r\n          type=\"text\"\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          placeholder=\"Descri칞칚o (ex: Poupan칞a Casamento)\"\r\n          className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"\r\n        />\r\n        <input\r\n          type=\"number\"\r\n          value={amount}\r\n          onChange={(e) => setAmount(e.target.value)}\r\n          placeholder=\"Valor (ex: 500.00)\"\r\n          className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"\r\n        />\r\n      </div>\r\n\r\n      {/* Linha 2: Data, Categoria e Meta (condicional) */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <input\r\n          type=\"date\"\r\n          value={date}\r\n          onChange={(e) => setDate(e.target.value)}\r\n          className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"\r\n        />\r\n        <select\r\n          value={categoryId}\r\n          onChange={(e) => setCategoryId(e.target.value)}\r\n          className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"\r\n        >\r\n          <option value=\"\" disabled>Selecione a Categoria</option>\r\n          {categories.map(cat => (\r\n            <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n          ))}\r\n        </select>\r\n        \r\n        {/* 游녢 O DROPDOWN CONDICIONAL 游녢 */}\r\n        {isMetaCategorySelected && (\r\n          <select\r\n            value={selectedGoalId}\r\n            onChange={(e) => setSelectedGoalId(e.target.value)}\r\n            className=\"p-3 bg-gray-700 rounded border border-yellow-500 focus:outline-none\"\r\n          >\r\n            <option value=\"\">Vincular a qual meta?</option>\r\n            {goals.map(goal => (\r\n              <option key={goal.id} value={goal.id}>{goal.name}</option>\r\n            ))}\r\n          </select>\r\n        )}\r\n      </div>\r\n\r\n      <button type=\"submit\" className=\"mt-6 w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded transition duration-300\">\r\n        Adicionar Despesa\r\n      </button>\r\n    </form>\r\n  );\r\n}\r\n\r\n// ... O resto da p치gina (ExpenseList, ExpensesPage) permanece o mesmo ...\r\n// --- Componente da Lista de Despesas ---\r\nfunction ExpenseList({ expenses, setExpenses }) {\r\n  \r\n  const handleDelete = (id) => {\r\n    if (confirm(\"Tem certeza que deseja deletar esta despesa?\")) {\r\n      axios.delete(`${API_URL}/expenses/${id}`)\r\n        .then(() => {\r\n          setExpenses(expenses.filter(exp => exp.id !== id));\r\n        })\r\n        .catch(error => console.error(\"Erro ao deletar despesa:\", error));\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString) => {\r\n    return new Date(dateString).toLocaleDateString('pt-BR', { timeZone: 'UTC' });\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-gray-800 p-6 rounded-lg shadow-lg\">\r\n      <h2 className=\"text-2xl font-bold mb-4 text-red-400\">Todas as Despesas</h2>\r\n      {expenses.length === 0 ? (\r\n        <p className=\"text-gray-400\">Nenhuma despesa registrada ainda.</p>\r\n      ) : (\r\n        <ul className=\"space-y-4\">\r\n          {expenses.map(expense => (\r\n            <li key={expense.id} className=\"flex justify-between items-center bg-gray-700 p-4 rounded\">\r\n              <div>\r\n                <span className=\"text-xs text-gray-400 block mb-1\">\r\n                  {formatDate(expense.date)}\r\n                </span>\r\n                <span className=\"font-semibold text-lg\">{expense.description}</span>\r\n                <span className={`text-sm ml-2 px-2 py-0.5 rounded ${expense.category ? 'bg-blue-600' : 'bg-gray-600'}`}>\r\n                  {expense.category ? expense.category.name : 'Sem Categoria'}\r\n                </span>\r\n                {/* Mostra a meta se estiver vinculada */}\r\n                {expense.goal && (\r\n                   <span className=\"text-sm ml-2 px-2 py-0.5 rounded bg-yellow-600\">\r\n                    &rarr; {expense.goal.name}\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <div className=\"flex items-center space-x-4\">\r\n                <span className=\"font-bold text-red-400 text-lg\">\r\n                  R$ {expense.amount.toFixed(2)}\r\n                </span>\r\n                <button\r\n                  onClick={() => handleDelete(expense.id)}\r\n                  className=\"text-gray-400 hover:text-red-500 transition duration-300\"\r\n                >\r\n                  &times;\r\n                </button>\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// --- Componente Principal da P치gina de Despesas ---\r\nexport default function ExpensesPage() {\r\n  const [expenses, setExpenses] = useState([]);\r\n\r\n  const fetchExpenses = () => {\r\n    // Agora usamos a rota /expenses/ com filtro de data (opcional)\r\n    // Para a p치gina de \"todas as despesas\", vamos buscar sem filtro\r\n    axios.get(`${API_URL}/expenses/`) \r\n      .then(response => {\r\n        setExpenses(response.data);\r\n      })\r\n      .catch(error => console.error(\"Erro ao buscar despesas:\", error));\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchExpenses();\r\n  }, []);\r\n\r\n  const handleNewExpense = (newExpense) => {\r\n     // Recarrega a lista inteira para obter dados da categoria/meta\r\n     fetchExpenses();\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <ExpenseForm onExpenseAdded={handleNewExpense} />\r\n      <ExpenseList expenses={expenses} setExpenses={setExpenses} />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}