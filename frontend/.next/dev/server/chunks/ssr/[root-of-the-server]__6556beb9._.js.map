{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mikae/Documents/ProjetosdeProgramacao/projeto-financeiro/frontend/app/budget/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst API_URL = 'http://localhost:8000';\r\n\r\nexport default function BudgetPage() {\r\n  const [groups, setGroups] = useState([]);\r\n  const [totalIncome, setTotalIncome] = useState(0);\r\n  const [totalPercentage, setTotalPercentage] = useState(0);\r\n\r\n  // Função para calcular a porcentagem total\r\n  // Definida antes para ser usada no fetchData e no handlePercentageChange\r\n  const calculateTotalPercentage = (currentGroups) => {\r\n    const total = currentGroups.reduce((acc, group) => acc + (group.target_percentage || 0), 0);\r\n    setTotalPercentage(total);\r\n  };\r\n\r\n  // Função para buscar os dados\r\n  // Definida antes do useEffect para evitar o erro de \"accessed before declaration\"\r\n  const fetchData = async () => {\r\n    try {\r\n      // Busca os grupos de orçamento E todas as entradas (receitas)\r\n      const [groupsRes, incomeRes] = await Promise.all([\r\n        axios.get(`${API_URL}/budget/`),\r\n        axios.get(`${API_URL}/income/`)\r\n      ]);\r\n      \r\n      setGroups(groupsRes.data);\r\n      calculateTotalPercentage(groupsRes.data);\r\n\r\n      // Calcula a renda total somando todas as entradas\r\n      const incomeTotal = incomeRes.data.reduce((acc, inc) => acc + inc.amount, 0);\r\n      setTotalIncome(incomeTotal);\r\n\r\n    } catch (error) {\r\n      console.error(\"Erro ao buscar dados:\", error);\r\n    }\r\n  };\r\n\r\n  // useEffect chama fetchData após ela ter sido definida\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handlePercentageChange = (groupId, newValue) => {\r\n    const newPercentage = parseInt(newValue);\r\n    const updatedGroups = groups.map(g => \r\n      g.id === groupId ? { ...g, target_percentage: newPercentage } : g\r\n    );\r\n    setGroups(updatedGroups);\r\n    calculateTotalPercentage(updatedGroups);\r\n\r\n    // Salva no backend sem esperar a resposta (otimista)\r\n    axios.put(`${API_URL}/budget/${groupId}?target_percentage=${newPercentage}`)\r\n      .catch(error => console.error(\"Erro ao salvar porcentagem:\", error));\r\n  };\r\n\r\n  // Função auxiliar para formatar moeda (R$)\r\n  const formatCurrency = (value) => {\r\n    return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h1 className=\"text-3xl font-bold mb-6\">Planejamento de Orçamento</h1>\r\n\r\n      {/* Card de Resumo da Renda */}\r\n      <div className=\"bg-gray-800 p-6 rounded-lg shadow-lg mb-8 flex justify-between items-center\">\r\n        <div>\r\n          <h2 className=\"text-gray-400 text-sm font-medium mb-1\">Sua Renda Total Estimada</h2>\r\n          <p className=\"text-4xl font-bold text-green-400\">{formatCurrency(totalIncome)}</p>\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <h2 className=\"text-gray-400 text-sm font-medium mb-1\">Total Alocado</h2>\r\n          <p className={`text-3xl font-bold ${totalPercentage === 100 ? 'text-blue-400' : 'text-yellow-500'}`}>\r\n            {totalPercentage}%\r\n          </p>\r\n          {totalPercentage !== 100 && (\r\n            <span className=\"text-xs text-red-400 block mt-1\">\r\n              Tente fechar em 100%\r\n            </span>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista de Grupos com Sliders */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {groups.map(group => {\r\n          // Calcula o valor em R$ para este grupo com base na % e na renda total\r\n          const recommendedValue = (totalIncome * (group.target_percentage / 100)) || 0;\r\n\r\n          return (\r\n            <div key={group.id} className=\"bg-gray-800 p-6 rounded-lg shadow-lg\">\r\n              <div className=\"flex justify-between items-start mb-4\">\r\n                <div>\r\n                  <h3 className=\"text-xl font-bold text-white\">{group.name}</h3>\r\n                  <span className=\"text-blue-400 font-medium text-lg\">\r\n                    {group.target_percentage}%\r\n                  </span>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                  <span className=\"text-gray-400 text-sm block\">Valor Recomendado</span>\r\n                  <span className=\"text-2xl font-bold text-green-400\">\r\n                    {formatCurrency(recommendedValue)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              <input\r\n                type=\"range\"\r\n                min=\"0\"\r\n                max=\"100\"\r\n                value={group.target_percentage}\r\n                onChange={(e) => handlePercentageChange(group.id, e.target.value)}\r\n                className=\"w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500\"\r\n              />\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}