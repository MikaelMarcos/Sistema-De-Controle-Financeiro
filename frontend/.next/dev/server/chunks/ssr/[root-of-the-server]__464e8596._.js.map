{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 17, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mikae/Documents/ProjetosdeProgramacao/projeto-financeiro/frontend/app/expenses/page.js"],"sourcesContent":["function ExpenseForm({ onExpenseAdded }) {\r\n  const [description, setDescription] = useState('');\r\n  const [amount, setAmount] = useState('');\r\n  const [date, setDate] = useState('');\r\n  const [paid, setPaid] = useState(true); \r\n  const [groupId, setGroupId] = useState(null);\r\n  const [subcategoryId, setSubcategoryId] = useState(null);\r\n  const [newSubcategoryName, setNewSubcategoryName] = useState('');\r\n  const [budgetGroups, setBudgetGroups] = useState([]);\r\n  const [subcategories, setSubcategories] = useState([]);\r\n  const [goals, setGoals] = useState([]);\r\n  const [selectedGoalId, setSelectedGoalId] = useState(null);\r\n  const [metaGroupId, setMetaGroupId] = useState(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [suggestionApplied, setSuggestionApplied] = useState(false); // üí° NOVO\r\n\r\n  // Ref para o timer do debounce\r\n  const debounceTimer = useRef(null);\r\n\r\n  // Carrega dados iniciais (grupos, categorias, metas)\r\n  useEffect(() => {\r\n    Promise.all([\r\n      axios.get(`${API_URL}/budget/`),\r\n      axios.get(`${API_URL}/categories/`),\r\n      axios.get(`${API_URL}/goals/`)\r\n    ]).then(([groupsRes, catsRes, goalsRes]) => {\r\n      setBudgetGroups(groupsRes.data);\r\n      setSubcategories(catsRes.data);\r\n      setGoals(goalsRes.data);\r\n      const metaGroup = groupsRes.data.find(g => g.name.toLowerCase().includes(\"metas\"));\r\n      if (metaGroup) setMetaGroupId(metaGroup.id);\r\n    });\r\n  }, []);\r\n\r\n  // --- L√ìGICA DE SUGEST√ÉO AUTOM√ÅTICA ---\r\n  useEffect(() => {\r\n    setSuggestionApplied(false);\r\n    if (debounceTimer.current) {\r\n      clearTimeout(debounceTimer.current);\r\n    }\r\n    if (description.trim() === '') {\r\n      return;\r\n    }\r\n    debounceTimer.current = setTimeout(() => {\r\n      axios.get(`${API_URL}/rules/suggest?description=${description}`)\r\n        .then(response => {\r\n          const rule = response.data;\r\n          setGroupId(rule.budget_group_id);\r\n          setSubcategoryId(rule.category_id);\r\n          setSuggestionApplied(true);\r\n        })\r\n        .catch(error => { /* Nenhuma sugest√£o encontrada */ });\r\n    }, 800);\r\n\r\n    return () => {\r\n      if (debounceTimer.current) {\r\n        clearTimeout(debounceTimer.current);\r\n      }\r\n    };\r\n  }, [description]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!description || !amount || !groupId) {\r\n      alert(\"Preencha os campos obrigat√≥rios.\");\r\n      return;\r\n    }\r\n    setIsSubmitting(true);\r\n    try {\r\n      let finalSubcategoryId = subcategoryId;\r\n      if (newSubcategoryName) {\r\n        const catRes = await axios.post(`${API_URL}/categories/`, { name: newSubcategoryName });\r\n        finalSubcategoryId = catRes.data.id;\r\n        setSubcategories(prev => [...prev, catRes.data]);\r\n      }\r\n      const newExpense = {\r\n        description,\r\n        amount: parseFloat(amount),\r\n        date: date ? new Date(date).toISOString() : new Date().toISOString(),\r\n        paid: paid,\r\n        budget_group_id: parseInt(groupId),\r\n        category_id: finalSubcategoryId ? parseInt(finalSubcategoryId) : null,\r\n        goal_id: (parseInt(groupId) === metaGroupId && selectedGoalId) ? parseInt(selectedGoalId) : null\r\n      };\r\n      await axios.post(`${API_URL}/expenses/`, newExpense);\r\n      setDescription(''); setAmount(''); setDate(''); setPaid(true);\r\n      setGroupId(null); setSubcategoryId(null); setNewSubcategoryName(''); setSelectedGoalId(null);\r\n      onExpenseAdded();\r\n    } catch (error) {\r\n      console.error(\"Erro:\", error);\r\n      alert(\"Erro ao cadastrar despesa.\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"bg-gradient-to-br from-fin-card to-fin-dark/80 p-8 rounded-3xl shadow-2xl mb-8 border border-fin-gold/20 backdrop-blur-sm\">\r\n      <div className=\"flex items-center gap-3 mb-8\">\r\n        <div className=\"p-3 bg-fin-gold/20 rounded-2xl\"><span className=\"text-2xl\">üí∞</span></div>\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-white\">Nova Transa√ß√£o</h2>\r\n          {/* üëá LINHA CORRIGIDA üëá */}\r\n          <p className=\"text-fin-gold/70 text-sm\">Registre despesas ou agendamentos</p>\r\n        </div>\r\n      </div>\r\n      \r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-fin-gold border-b border-fin-gold/30 pb-2\">Informa√ß√µes B√°sicas</h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-white/80 mb-2\">Descri√ß√£o *</label>\r\n              <input type=\"text\" value={description} onChange={(e) => setDescription(e.target.value)} placeholder=\"Ex: Conta de Luz, Supermercado...\" className=\"w-full p-4 bg-fin-dark/60 rounded-xl border-2 border-white/10 focus:border-fin-gold focus:ring-2 focus:ring-fin-gold/20 transition-all text-white placeholder-white/40\"/>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-white/80 mb-2\">Valor *</label>\r\n              <div className=\"relative\">\r\n                <span className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-fin-gold font-bold\">R$</span>\r\n                <input type=\"number\" step=\"0.01\" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder=\"0,00\" className=\"w-full p-4 pl-12 bg-fin-dark/60 rounded-xl border-2 border-white/10 focus:border-fin-gold focus:ring-2 focus:ring-fin-gold/20 transition-all text-white\"/>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-white/80 mb-2\">Data</label>\r\n              <input type=\"date\" value={date} onChange={(e) => setDate(e.target.value)} className=\"w-full p-4 bg-fin-dark/60 rounded-xl border-2 border-white/10 focus:border-fin-gold focus:ring-2 focus:ring-fin-gold/20 transition-all text-white\"/>\r\n            </div>\r\n            <div className=\"relative\">\r\n              <CustomSelect label=\"Grupo *\" required value={groupId} onChange={setGroupId} options={budgetGroups} placeholder=\"Selecione um grupo\" textClass=\"font-semibold\"/>\r\n              {suggestionApplied && <span className=\"absolute -top-2 -right-2 text-xs bg-fin-highlight text-fin-dark font-bold px-2 py-0.5 rounded-full animate-pulse\">üí°</span>}\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-white/80 mb-2\">Status</label>\r\n              <div className={`w-full p-4 rounded-xl border-2 transition-all cursor-pointer ${paid ? 'bg-green-500/20 border-green-500/50 text-green-400' : 'bg-yellow-500/20 border-yellow-500/50 text-yellow-400'}`} onClick={() => setPaid(!paid)}>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"font-bold\">{paid ? '‚úÖ PAGO' : '‚è≥ PENDENTE'}</span>\r\n                  <div className={`w-3 h-3 rounded-full ${paid ? 'bg-green-400' : 'bg-yellow-400'}`}></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-fin-gold border-b border-fin-gold/30 pb-2\">Categoriza√ß√£o (Opcional)</h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div className=\"relative\">\r\n              <CustomSelect label=\"Subcategoria\" value={subcategoryId} onChange={setSubcategoryId} options={subcategories} placeholder=\"Selecionar existente\"/>\r\n              {suggestionApplied && <span className=\"absolute -top-2 -right-2 text-xs bg-fin-highlight text-fin-dark font-bold px-2 py-0.5 rounded-full animate-pulse\">üí°</span>}\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-white/80 mb-2\">Nova Subcategoria</label>\r\n              <input type=\"text\" value={newSubcategoryName} onChange={(e) => setNewSubcategoryName(e.target.value)} disabled={!!subcategoryId} placeholder=\"Criar nova...\" className=\"w-full p-4 bg-fin-dark/60 rounded-xl border-2 border-white/10 focus:border-fin-gold transition-all text-white placeholder-white/40 disabled:opacity-50\"/>\r\n            </div>\r\n          </div>\r\n          {parseInt(groupId) === metaGroupId && (\r\n            <CustomSelect label=\"Vincular √† Meta\" value={selectedGoalId} onChange={setSelectedGoalId} options={goals} placeholder=\"Selecionar meta...\" textClass=\"text-fin-highlight\"/>\r\n          )}\r\n        </div>\r\n\r\n        <button \r\n          type=\"submit\" \r\n          disabled={isSubmitting}\r\n          className=\"w-full bg-gradient-to-r from-rose-500 to-fin-red hover:from-rose-600 hover:to-red-700 disabled:opacity-50 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-[1.02] shadow-lg flex items-center justify-center gap-2\"\r\n          style={{\r\n            boxShadow: '0 4px 20px rgba(244, 63, 94, 0.25)' // sombra avermelhada\r\n          }}\r\n        >\r\n          {isSubmitting ? (\r\n            <>\r\n              <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\r\n              Processando...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <span>{paid ? 'üíæ' : 'üìÖ'}</span>\r\n              {paid ? 'Registrar Pagamento' : 'Agendar Despesa'}\r\n            </>\r\n          )}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}