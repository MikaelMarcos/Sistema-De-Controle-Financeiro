{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mikae/Documents/ProjetosdeProgramacao/projeto-financeiro/frontend/app/expenses/page.js"],"sourcesContent":["'use client'; \r\n\r\nimport { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst API_URL = 'http://localhost:8000';\r\n\r\nfunction ExpenseForm({ onExpenseAdded }) {\r\n  const [description, setDescription] = useState('');\r\n  const [amount, setAmount] = useState('');\r\n  const [date, setDate] = useState('');\r\n  \r\n  // 游녢 NOVOS ESTADOS: Grupo (Obrigat칩rio) e Subcategoria (Opcional)\r\n  const [groupId, setGroupId] = useState('');\r\n  const [subcategoryId, setSubcategoryId] = useState('');\r\n  const [newSubcategoryName, setNewSubcategoryName] = useState(''); // Para criar na hora\r\n\r\n  const [budgetGroups, setBudgetGroups] = useState([]);\r\n  const [subcategories, setSubcategories] = useState([]);\r\n  const [goals, setGoals] = useState([]);\r\n  \r\n  const [selectedGoalId, setSelectedGoalId] = useState('');\r\n  const [metaGroupId, setMetaGroupId] = useState(null);\r\n\r\n  // Busca dados iniciais\r\n  useEffect(() => {\r\n    Promise.all([\r\n      axios.get(`${API_URL}/budget/`),\r\n      axios.get(`${API_URL}/categories/`),\r\n      axios.get(`${API_URL}/goals/`)\r\n    ]).then(([groupsRes, catsRes, goalsRes]) => {\r\n      setBudgetGroups(groupsRes.data);\r\n      setSubcategories(catsRes.data);\r\n      setGoals(goalsRes.data);\r\n\r\n      // Encontra o ID do grupo \"Metas\" para a l칩gica de vincula칞칚o\r\n      const metaGroup = groupsRes.data.find(g => g.name.toLowerCase().includes(\"metas\"));\r\n      if (metaGroup) setMetaGroupId(metaGroup.id);\r\n    });\r\n  }, []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!description || !amount || !groupId) {\r\n      alert(\"Preencha Descri칞칚o, Valor e GRUPO (Obrigat칩rio).\");\r\n      return;\r\n    }\r\n\r\n    let finalSubcategoryId = subcategoryId;\r\n\r\n    // 游녢 L칍GICA PARA CRIAR NOVA SUBCATEGORIA NA HORA\r\n    if (newSubcategoryName) {\r\n      try {\r\n        const catRes = await axios.post(`${API_URL}/categories/`, { name: newSubcategoryName });\r\n        finalSubcategoryId = catRes.data.id;\r\n        // Atualiza a lista local de subcategorias\r\n        setSubcategories(prev => [...prev, catRes.data]);\r\n      } catch (error) {\r\n        console.error(\"Erro ao criar subcategoria:\", error);\r\n        alert(\"Erro ao criar nova subcategoria.\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    const newExpense = {\r\n      description,\r\n      amount: parseFloat(amount),\r\n      budget_group_id: parseInt(groupId),         // Obrigat칩rio\r\n      category_id: finalSubcategoryId ? parseInt(finalSubcategoryId) : null, // Opcional\r\n      goal_id: null,\r\n      date: date ? new Date(date).toISOString() : new Date().toISOString()\r\n    };\r\n\r\n    if (parseInt(groupId) === metaGroupId && selectedGoalId) {\r\n      newExpense.goal_id = parseInt(selectedGoalId);\r\n    }\r\n\r\n    axios.post(`${API_URL}/expenses/`, newExpense)\r\n      .then(response => {\r\n        // Limpa o formul치rio\r\n        setDescription(''); setAmount(''); setDate('');\r\n        setGroupId(''); setSubcategoryId(''); setNewSubcategoryName('');\r\n        setSelectedGoalId('');\r\n        onExpenseAdded(); \r\n      })\r\n      .catch(error => console.error(\"Erro ao adicionar despesa:\", error));\r\n  };\r\n  \r\n  const isMetaGroupSelected = parseInt(groupId) === metaGroupId;\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"bg-gray-800 p-6 rounded-lg shadow-lg mb-8\">\r\n      <h2 className=\"text-2xl font-bold mb-4 text-red-400\">Nova Despesa</h2>\r\n      \r\n      {/* Linha 1: Descri칞칚o e Valor */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\"> \r\n        <input type=\"text\" value={description} onChange={(e) => setDescription(e.target.value)} placeholder=\"Descri칞칚o (ex: Almo칞o)\" className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"/>\r\n        <input type=\"number\" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder=\"Valor (ex: 50.00)\" className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"/>\r\n      </div>\r\n\r\n      {/* Linha 2: Data e GRUPO OBRIGAT칍RIO */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n        <input type=\"date\" value={date} onChange={(e) => setDate(e.target.value)} className=\"p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:border-red-500\"/>\r\n        \r\n        {/* 游녢 GRUPO (OBRIGAT칍RIO) 游녢 */}\r\n        <select value={groupId} onChange={(e) => setGroupId(e.target.value)} className=\"p-3 bg-gray-700 rounded border-2 border-red-500 focus:outline-none font-bold text-white\">\r\n          <option value=\"\">SELECIONE O GRUPO (Obrigat칩rio)</option>\r\n          {budgetGroups.map(group => (\r\n            <option key={group.id} value={group.id}>{group.name}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n\r\n      {/* Linha 3: Subcategoria (Opcional) e Metas */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        {/* Subcategoria Existente */}\r\n        <select value={subcategoryId} onChange={(e) => setSubcategoryId(e.target.value)} disabled={!!newSubcategoryName} className={`p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none ${newSubcategoryName ? 'opacity-50' : ''}`}>\r\n          <option value=\"\">Subcategoria (Opcional)</option>\r\n          {subcategories.map(cat => (\r\n            <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n          ))}\r\n        </select>\r\n\r\n        {/* OU Criar Nova Subcategoria */}\r\n        <input type=\"text\" value={newSubcategoryName} onChange={(e) => setNewSubcategoryName(e.target.value)} disabled={!!subcategoryId} placeholder=\"Ou digite uma nova Subcategoria...\" className={`p-3 bg-gray-700 rounded border border-gray-600 focus:outline-none ${subcategoryId ? 'opacity-50' : ''}`}/>\r\n      </div>\r\n\r\n      {/* Dropdown Condicional de Metas */}\r\n      {isMetaGroupSelected && (\r\n        <div className=\"mt-4\">\r\n          <select value={selectedGoalId} onChange={(e) => setSelectedGoalId(e.target.value)} className=\"w-full p-3 bg-gray-700 rounded border border-yellow-500 focus:outline-none\">\r\n            <option value=\"\">Vincular a qual meta?</option>\r\n            {goals.map(goal => (<option key={goal.id} value={goal.id}>{goal.name}</option>))}\r\n          </select>\r\n        </div>\r\n      )}\r\n\r\n      <button type=\"submit\" className=\"mt-6 w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded transition duration-300\">Adicionar Despesa</button>\r\n    </form>\r\n  );\r\n}\r\n\r\nfunction ExpenseList({ expenses, setExpenses }) {\r\n  const handleDelete = (id) => {\r\n    if (confirm(\"Deletar despesa?\")) {\r\n      axios.delete(`${API_URL}/expenses/${id}`)\r\n        .then(() => setExpenses(expenses.filter(exp => exp.id !== id)))\r\n        .catch(error => console.error(\"Erro:\", error));\r\n    }\r\n  };\r\n  const formatDate = (d) => new Date(d).toLocaleDateString('pt-BR', { timeZone: 'UTC' });\r\n\r\n  return (\r\n    <div className=\"bg-gray-800 p-6 rounded-lg shadow-lg\">\r\n      <h2 className=\"text-2xl font-bold mb-4 text-red-400\">칔ltimas Despesas</h2>\r\n      <ul className=\"space-y-4\">\r\n        {expenses.map(expense => (\r\n          <li key={expense.id} className=\"flex justify-between items-center bg-gray-700 p-4 rounded\">\r\n            <div>\r\n              <span className=\"text-xs text-gray-400 block mb-1\">{formatDate(expense.date)}</span>\r\n              <span className=\"font-semibold text-lg\">{expense.description}</span>\r\n              \r\n              {/* Mostra GRUPO (Principal) */}\r\n              <span className=\"text-sm ml-2 px-2 py-0.5 rounded bg-blue-900 text-blue-200 font-bold\">\r\n                {expense.budget_group?.name}\r\n              </span>\r\n              \r\n              {/* Mostra SUBCATEGORIA (Opcional) */}\r\n              {expense.category && (\r\n                <span className=\"text-sm ml-2 px-2 py-0.5 rounded bg-gray-600\">\r\n                  {expense.category.name}\r\n                </span>\r\n              )}\r\n               {/* Mostra META */}\r\n               {expense.goal && (\r\n                   <span className=\"text-sm ml-2 px-2 py-0.5 rounded bg-yellow-600\">\r\n                    &rarr; {expense.goal.name}\r\n                  </span>\r\n                )}\r\n            </div>\r\n            <div className=\"flex items-center space-x-4\">\r\n              <span className=\"font-bold text-red-400 text-lg\">R$ {expense.amount.toFixed(2)}</span>\r\n              <button onClick={() => handleDelete(expense.id)} className=\"text-gray-400 hover:text-red-500\">&times;</button>\r\n            </div>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function ExpensesPage() {\r\n  const [expenses, setExpenses] = useState([]);\r\n  const fetchExpenses = () => {\r\n    axios.get(`${API_URL}/expenses/`).then(res => setExpenses(res.data));\r\n  };\r\n  useEffect(() => { fetchExpenses(); }, []);\r\n  return (\r\n    <div>\r\n      <ExpenseForm onExpenseAdded={fetchExpenses} />\r\n      <ExpenseList expenses={expenses} setExpenses={setExpenses} />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}